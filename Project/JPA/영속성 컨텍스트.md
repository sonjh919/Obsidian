---
title: 영속성 컨텍스트 (Persistence Context)
date: 2024-01-19 16:26
categories:
  - JPA
tags:
  - jpa
image: 
path:
---

## 영속성 컨텍스트 (Persistence Context)
+ Persistence를 한글로 번역하면 **영속성, 지속성**이라는 뜻이다.
+ 영속성을 객체의 관점으로 해석하자면 **‘객체가 생명(객체가 유지되는 시간)이나 공간(객체의 위치)을 자유롭게 유지하고 이동할수 있는 객체의 성질’** 을 의미한다.
+ 영속성 컨텍스트는 **[[Entity]] 객체를 효율적으로 쉽게 관리하기 위해 만들어진 공간**이다.

![[persistenceContext.png]]

+ 개발자들은 이제 직접 SQL을 작성하지 않아도 JPA를 사용하여 DB에 데이터를 저장하거나 조회할 수 있으며 수정, 삭제 또한 가능하다.
+ 이러한 일련의 과정을 효율적으로 처리하기 위해 **JPA는 영속성 컨텍스트에 Entity 객체들을 저장하여 관리하면서 DB와 소통**한다.

## 영속성 컨텍스트의 기능
+ [[1차 캐시]]
+ [[쓰기 지연 저장소]](Action Queue)
+ [[변경 감지]](Dirty Checking)
## 1차 캐시
- 영속성 컨텍스트는 내부적으로 캐시 저장소를 가지고 있다.
+ 우리가 저장하는 Entity 객체들이 1차 캐시 즉, 캐시 저장소에 저장된다.
+ 캐시 저장소는 Map 자료구조 형태로 되어있다.
 + **key**에는 @Id로 매핑한 기본 키 즉, 식별자 값을 저장하고, **value**에는 해당 Entity 클래스의 객체를 저장한다.


![[cash.png]]

### 캐시 저장소의 활용
#### Entity 저장
+ `em.persist(memo)` 메서드가 호출되면 memo Entity 객체를 캐시 저장소에 저장한다.

![[persist.png]]

```java
@Test
@DisplayName("1차 캐시 : Entity 저장")
void test1() {
    EntityTransaction et = em.getTransaction();

    et.begin();

    try {

        Memo memo = new Memo();
        memo.setId(1L);
        memo.setUsername("Robbie");
        memo.setContents("1차 캐시 Entity 저장");

        em.persist(memo);

        et.commit();

    } catch (Exception ex) {
        ex.printStackTrace();
        et.rollback();
    } finally {
        em.close();
    }

    emf.close();
}
```

저장된 정보는 em > persistenceContext > entitiesBykey에서 Map 형식인 것을 확인할 수 있다.

![[entitiesBykey.png]]

#### 