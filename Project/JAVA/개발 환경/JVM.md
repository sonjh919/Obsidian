---
title: JVM
date: 2023-12-28 15:57
categories:
  - Java
  - Java개발환경
tags:
  - Java
  - Java개발환경
image: 
path:
---

## 🌈 JVM(Java Virtual Machine)
Java는 C에서의 단점을 없애기 위해 JVM이라는 프로그램을 설치한다. 먼저 Java는 컴파일을 통해 하나의 목적 파일을 만들고, 이후에 JVM을 사용한다. 이 JVM이라는 친구는 각 플랫폼마다 설치되는데, **목적 파일을 각각의 운영체제로 전달될 수 있게 번역하는 역할이다.** 이 외에도 메모리 관리 등 효율적으로 관리하기 위한 **여러 수단들을 자동화해놓은 하나의 프로그램**, **Java가 실행되는 가상 컴퓨터**라고 생각하면 된다.

### 📌 JVM 전 처리 과정
[[JRE]]는 프로그램을 실행하기 전에 먼저 프로그램에 메인 메서드를 포함하고 있는지 확인하고 존재한다면 JVM을 부팅시킨다. 부팅된 JVM은 전달받은 코드를 실행시키는데, 이때 가장 먼저 하는 일을 전 처리 과정이라고 한다.

1. 모든 Java 프로그램은 반드시 [[Java.lang]] 패키지를 포함한다. 따라서 JRE는 해당 패키지를 Method Area에 배치한다.
2. 프로그램이 사용하기 위해 import한 패키지들도 Method Area에 배치한다.
3. 프로그램 상의 작성한 모든 클래스, 변수 및 메서드의 정보를 Method Area에 배치한다.
4. static 변수와 메서드는 Heap Area에 배치한다.

### 📌 JVM의 내부 구조
+ Class Loader Sub System
+ [[Runtime Data Areas]]
+ Execution Engine

![[JVM.png]]

### 📌 JVM의 Runtime Data Areas
자바 프로그램을 실행하여 발생하는 데이터를 저장하는 역할을 하는데, 데이터의 속성에 따라 영역이 분리되어 있다. (Java 8 이후 기준)

![[runtime.png]]

#### 🧶 PC Register
- 스레드가 시작될 때마다 생성되는 공간으로, 스레드마다 하나씩 존재한다.
- 스레드가 어떤 명령에 의해 실행되어야 할지에 대한 기록을 하는 부분으로 현재 수행을 하고 있는 **JVM의 명령 주소를 갖고 있다.**

#### 🧶 Native Method Stack
- 자바 프로그램이 컴파일 되어 생성되는 바이트 코드가 아닌 실제 실행할 수 있는 기계어로 작성된 프로그램을 실행시키는 영역이다.
- 자바 이외의 언어(C, C++, 어셈블리 등)로 작성된 코드를 실행할 때, Native Method Stack이 할당 되며, 일반적인 C 스택을 사용한다.
- Java Native Interface를 통해 바이트 코드로 전환하여 저장된다.
- 일반 프로그램처럼 커널이 스택을 잡아 독자적으로 프로그램을 실행시키는 영역이다.

#### 🧶 Method Area
+ = **Metaspace, Static Area, Class Area**
- 클래스 정보를 처음 메모리 공간에 올릴 때 초기화 되는 대상을 저장하기 위한 공간이다.
- 클래스의 타입, 변수 및 메서드등의 정보를 가지고 있으며 **모든 Thread가 공유**한다.

#### 🧶 Heap Area
+ 객체(인스턴스)가 생성되는 영역으로, 프로그램을 실행하는 중 생성되는 **객체들은 모두 이곳에 생성**된다.
+ Garbage collector의 주요 대상이 된다.

#### 🧶 Stack Area
+ 프로그램 실행 과정에서 **임시로 할당이 되었다가 메서드를 빠져나가면 바로 소멸이 되는 특성의 데이터**들을 저장하기 위한 영역이다.
+ 실행되는 메서드 및 중괄호 블록(if문등)에 대한 데이터가 저장되는 영역이다.
+ **가장 처음 실행되는 메서드(main())가 첫 번째로 메모리에 올라가고 그 다음에 실행되는 메서드들이 위에 쌓이는 구조**
+ 쌓이는 메서드의 단위를 스택 프레임이라고 부르며, 스택 프레임 내부에 스택 프레임이 생길 수도 있다.
+ 멀티 스레드 환경에서 **각 스레드가 고유의 스택영역**을 가진다.